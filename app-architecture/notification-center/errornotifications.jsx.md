# ErrorNotifications.jsx

The `ErrorNotifications.jsx` component is a key element of the AllyArm application's error management system. This component provides real-time, user-friendly notifications for error messages generated by the system or server, ensuring that users are immediately informed of any critical issues. Here's a detailed breakdown of the architecture and functionality of the `ErrorNotifications.jsx` component:

## 1. **Core Imports and Dependencies**

{% tabs %}
{% tab title="JavaScript" %}
```javascript
import React, { useState, useEffect } from "react";
import { ToastContainer, toast } from "react-toastify";
import "react-toastify/dist/ReactToastify.css";
import { subscribeToMessages, unsubscribeFromMessages } from "../Socket";
import { BiErrorAlt } from "react-icons/bi";
```
{% endtab %}
{% endtabs %}

* **React**: Utilizes `useState` and `useEffect` hooks for state management and side effects, critical for handling dynamic data updates.
* **React Toastify**: The `react-toastify` library is used for creating toast notifications that are displayed to the user. It provides customizable and responsive notifications that can be styled and managed with ease.
* **Socket Integration**: Custom WebSocket functions, `subscribeToMessages` and `unsubscribeFromMessages`, manage real-time communication with the backend, ensuring that error messages are instantly pushed to the user interface.
* **Icons**: The `react-icons` library, specifically the `BiErrorAlt` icon, is used to visually distinguish error notifications, enhancing user experience by clearly identifying issues.

## 2. **State Management**

{% tabs %}
{% tab title="JavaScript" %}
```javascript
const [lastErrorMessage, setLastErrorMessage] = useState(null);
const [shownErrorIds, setShownErrorIds] = useState(new Set());
```
{% endtab %}
{% endtabs %}

* **Last Error Message**: Keeps track of the most recent error message received from the server, allowing the component to manage and display the latest issues.
* **Shown Error IDs**: Utilizes a `Set` to track which error notifications have already been displayed, preventing duplicate notifications for the same error.

## 3. **WebSocket Integration and Error Handling**

{% tabs %}
{% tab title="JavaScript" %}
{% code overflow="wrap" %}
```javascript
useEffect(() => {
  const errorCodes = [];
  const senderErrorCodes = [];
  const notificationErrorIds = [];

  const handleDataUpdate = (data) => {
    const { errorData, errorServerMessage } = data;

    if (errorServerMessage && errorServerMessage.id && !shownErrorIds.has(errorServerMessage.id)) {
      toast.error(`Server - ${errorServerMessage.id}: ${errorServerMessage.message}`, {
        autoClose: 5000,
        icon: <BiErrorAlt fill="red" size="2em" />,
      });

      setShownErrorIds(new Set(shownErrorIds.add(errorServerMessage.id)));
      setLastErrorMessage(errorServerMessage);
    }
```
{% endcode %}
{% endtab %}
{% endtabs %}

* **Real-Time Data Handling**: The `useEffect` hook subscribes to real-time messages from the backend. When new data is received, the component checks if the error is new and has not been displayed yet, ensuring that the same error is not notified multiple times.
* **Server Error Notifications**: If an error is received from the server, it is displayed as a toast notification with a unique ID. The notification includes a distinct error icon and automatically disappears after 5 seconds.

## 4. **Dynamic Error Management**

{% tabs %}
{% tab title="JavaScript" %}
```javascript
const activeErrorCodes = errorData.map((error) => error.errorCode);
const dismissedErrorIds = [];

notificationErrorIds.forEach((notificationId) => {
  const errorCode = Number(notificationId.split("-")[1]);
  if (!activeErrorCodes.includes(errorCode)) {
    toast.dismiss(notificationId);
    dismissedErrorIds.push(notificationId);
  }
});

dismissedErrorIds.forEach((notificationId) => {
  const index = notificationErrorIds.indexOf(notificationId);
  if (index !== -1) {
    notificationErrorIds.splice(index, 1);
  }
});
```
{% endtab %}
{% endtabs %}

* **Active Error Codes**: Extracts active error codes from the received error data, which represent the current issues in the system.
* **Dismissal of Resolved Errors**: The component tracks and dismisses notifications for errors that have been resolved, ensuring that users are only notified of active issues. This prevents the cluttering of the UI with outdated or resolved error messages.

## 5. **Error Notification Creation**

{% tabs %}
{% tab title="JavaScript" %}
```javascript
errorData.forEach((error) => {
  const { errorCode, axis, message } = error;
  const notificationId = `error-${errorCode}-${axis}`;
  if (!notificationErrorIds.includes(notificationId)) {
    errorCodes.push(errorCode);
    senderErrorCodes.push(axis);

    let nAxis;
    if (axis !== "Master") {
      nAxis = "Axis " + axis;
    } else {
      nAxis = axis;
    }

    toast.error(`${nAxis} - ${errorCode}: ${message}`, {
      toastId: notificationId,
      icon: <BiErrorAlt fill="red" size="2em" />,
    });

    notificationErrorIds.push(notificationId);
  }
});
```
{% endtab %}
{% endtabs %}

* **Notification Generation**: For each error in the `errorData` array, a unique notification ID is generated. This ID is used to ensure that each error is only notified once.
* **Custom Notifications**: The error message is customized based on the axis and error code, providing context to the user. For example, errors related to specific axes are labeled accordingly, helping users to identify the source of the problem quickly.
* **Visual Consistency**: Each notification includes a red error icon (`BiErrorAlt`), reinforcing the severity of the message and ensuring visual consistency across the UI.

## 6. **Cleanup and Unsubscription**

{% tabs %}
{% tab title="JavaScript" %}
```javascript
const handleCleanup = () => {
  toast.dismiss();
};

subscribeToMessages(handleDataUpdate);

return () => {
  unsubscribeFromMessages(handleDataUpdate);
  handleCleanup();
};
```
{% endtab %}
{% endtabs %}

* **Component Cleanup**: When the component is unmounted, it unsubscribes from the WebSocket messages and dismisses all active toast notifications. This prevents memory leaks and ensures that the component does not continue to receive or display outdated messages after it has been removed from the DOM.

## 7. **Rendering the Toast Container**

{% tabs %}
{% tab title="JavaScript" %}
```javascript
return (
  <ToastContainer
    position="bottom-right"
    autoClose={5000}
    hideProgressBar={false}
    newestOnTop
    closeOnClick={false}
    rtl={false}
    pauseOnFocusLoss={false}
    draggable={false}
    closeButton={false}
    theme="colored"
  />
);
```
{% endtab %}
{% endtabs %}

* **Toast Container Configuration**: The `ToastContainer` component is configured to display notifications at the bottom-right corner of the screen. The notifications automatically close after 5 seconds, and the progress bar is shown to indicate the remaining time. The `newestOnTop` option ensures that the most recent notifications are displayed at the top, making them more visible to the user.

{% hint style="info" %}
This detailed explanation covers the key architectural aspects of the `ErrorNotifications.jsx` component, illustrating how it integrates real-time error management with user-friendly notifications. The component's design ensures that users are always aware of critical issues while maintaining a clean and efficient user interface.
{% endhint %}
